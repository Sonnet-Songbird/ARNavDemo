<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>AR.js A-Frame</title>
    <script src="../aframe/build/aframe.min.js"></script>
    <!-- Assumes AR.js build is in the 'AR.js' directory -->
    <script type='text/javascript' src='../three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript' src='../aframe/build/aframe-ar.js'></script>
    <script src='index.js'></script>
</head>
<body>
    <a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false'
             renderer='antialias: true; alpha: true'>
        <!--
            <a-camera gps-new-camera='gpsMinDistance: 5' look-controls-enabled='false' arjs-device-orientation-controls></a-camera>
        -->
        <a-camera gps-new-camera='gpsMinDistance: 5'></a-camera>
    </a-scene>
    <div id='setloc'
         style='position:absolute; left: 10px; bottom: 2%; z-index:999; background-color: blue; color: white; padding: 10px'>
        Lat:<input id="lat" value="50.000"/>
        Lon: <input id="lon" value="-50.000"/>
        Min Acc: <input id='minacc' value='1000'/> <input type='button' id='go' value='go'/> <input type='button' id='toggle' value='박스 고정'/>
    </div>
</body>
<script>
    let updateLocation = true;
    window.onload = () => {
        let testEntitiesAdded = false;
        const el = document.querySelector("[gps-new-camera]");
        el.addEventListener("gps-camera-update-position", e => {
            if (!testEntitiesAdded) {
                alert(`최초 감지 된 GPS position: lon ${e.detail.position.longitude} lat ${e.detail.position.latitude}`);
                const properties = [{
                    color: 'red',
                    latDis: 0.001,
                    lonDis: 0
                }, {
                    color: 'yellow',
                    latDis: -0.001,
                    lonDis: 0
                }, {
                    color: 'blue',
                    latDis: 0,
                    lonDis: -0.001
                }, {
                    color: 'green',
                    latDis: 0,
                    lonDis: 0.001
                }
                ];
                if(updateLocation)
                for (const prop of properties) {
                    const entity = document.createElement("a-box");
                    entity.setAttribute("scale", {
                        x: 20,
                        y: 20,
                        z: 20
                    });
                    entity.setAttribute('material', {color: prop.color});
                    entity.setAttribute('gps-new-entity-place', {
                        latitude: e.detail.position.latitude + prop.latDis,
                        longitude: e.detail.position.longitude + prop.lonDis
                    });
                    entity.setAttribute('anchored', 'persistent: true');
                    entity.setAttribute('geometry', "primitive: box");
                    document.querySelector("a-scene").appendChild(entity);
                }
                testEntitiesAdded = true;
            }
        });

        document.getElementById("go").addEventListener("click", e => {
            const lat = document.getElementById('lat').value;
            const lon = document.getElementById('lon').value;
            const minacc = document.getElementById('minacc').value;

            el.setAttribute('gps-new-camera', {
                simulateLatitude: lat,
                simulateLongitude: lon,
                positionMinAccuracy: minacc
            });
        });
        document.getElementById("toggle").addEventListener("click", e => {
            updateLocation = !updateLocation;
        })
    };

</script>
</html>
